<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Interactivo - Ranking Productos 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 30px 90px rgba(0,0,0,0.5);
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3.5em;
            margin-bottom: 15px;
            font-weight: 900;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.3em;
        }

        /* CONTROLES INTERACTIVOS */
        .controls-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            color: white;
        }

        .controls-section h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-box input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .search-box button {
            padding: 15px 30px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .filter-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 25px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 10px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-btn:hover {
            background: white;
            color: #667eea;
        }

        .filter-btn.active {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .subvalue {
            font-size: 0.95em;
            opacity: 0.8;
        }

        .stat-card.martinez {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.nunez {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* SECCIONES */
        .section {
            margin-bottom: 60px;
        }

        .section h2 {
            color: #667eea;
            border-bottom: 4px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 35px;
            font-size: 2.2em;
            font-weight: 700;
        }

        /* TABLAS */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        td {
            padding: 18px;
            border-bottom: 1px solid #eee;
        }

        tr:nth-child(even) {
            background: #f8f9ff;
        }

        tr:hover {
            background: #e8ecff;
        }

        .highlight {
            background: #fff3cd !important;
            font-weight: bold;
        }

        .chart-container {
            background: #f8f9ff;
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 35px;
            position: relative;
            height: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }

        .comparison-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .comparison-card h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .comparison-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .comparison-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .comparison-item .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .comparison-item.martinez .value {
            color: #f5576c;
        }

        .comparison-item.nunez .value {
            color: #4facfe;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Dashboard Interactivo - Ranking 2025</h1>
        <p class="subtitle">An√°lisis Completo con Filtros | Mart√≠nez vs N√∫√±ez</p>

        <!-- CONTROLES INTERACTIVOS -->
        <div class="controls-section">
            <h2>üéØ Selector de Local y Filtros</h2>

            <!-- SELECTOR DE LOCAL -->
            <div style="margin-bottom: 25px;">
                <h3 style="margin-bottom: 15px; font-size: 1.2em;">üìç Ver datos de:</h3>
                <div class="filter-buttons">
                    <button class="filter-btn local-btn active" onclick="changeLocal('comparativo')" data-local="comparativo">üìä Comparativo MZ vs NU</button>
                    <button class="filter-btn local-btn" onclick="changeLocal('martinez')" data-local="martinez">üè¢ Solo Mart√≠nez</button>
                    <button class="filter-btn local-btn" onclick="changeLocal('nunez')" data-local="nunez">üè¢ Solo N√∫√±ez</button>
                </div>
            </div>

            <!-- BUSCADOR -->
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar producto (ej: caf√©, botana, taco res, margarita...)">
                <button onclick="searchProduct()">Buscar</button>
                <button onclick="clearSearch()">Limpiar</button>
            </div>

            <!-- FILTROS POR CATEGOR√çA MAXIREST -->
            <div style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; font-size: 1.2em;">üè∑Ô∏è Filtrar por categor√≠a:</h3>
                <div class="filter-buttons">
                    <button class="filter-btn cat-btn active" onclick="filterCategory('todas')">Todas</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('Bebidas s/a')">üçπ Bebidas</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('Comida')">üçΩÔ∏è Comida</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('Tacos')">üåÆ Tacos</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('Postres')">üç∞ Postres</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('Salsas')">üå∂Ô∏è Salsas</button>
                    <button class="filter-btn cat-btn" onclick="filterCategory('UPGRADE Tequila')">ü•É Upgrades</button>
                </div>
            </div>
        </div>

        <!-- RESULTADO DE B√öSQUEDA -->
        <div id="searchResults" style="display: none;">
            <!-- Aqu√≠ se mostrar√°n los resultados -->
        </div>

        <!-- STATS CARDS -->
        <div class="stats-grid">
            <div class="stat-card martinez">
                <h3>Mart√≠nez - Facturaci√≥n</h3>
                <div class="value">$943M</div>
                <div class="subvalue">ARS Total A√±o 2025</div>
            </div>
            <div class="stat-card nunez">
                <h3>N√∫√±ez - Facturaci√≥n</h3>
                <div class="value">$455M</div>
                <div class="subvalue">ARS Total A√±o 2025</div>
            </div>
            <div class="stat-card martinez">
                <h3>Mart√≠nez - Unidades</h3>
                <div class="value" id="unidadesMZ">89.590</div>
                <div class="subvalue">Productos Vendidos</div>
            </div>
            <div class="stat-card nunez">
                <h3>N√∫√±ez - Unidades</h3>
                <div class="value" id="unidadesNU">43.379</div>
                <div class="subvalue">Productos Vendidos</div>
            </div>
        </div>

        <!-- TABLA COMPLETA FILTRABLE -->
        <div class="section">
            <h2 id="tableTitle">üìä Ranking Completo de Productos - Comparativo</h2>
            <p style="margin-bottom: 20px; color: #666;">Haz clic en los encabezados para ordenar. <span id="filterStatus">Mostrando: Todas las categor√≠as</span></p>

            <div style="overflow-x: auto;">
                <table id="productsTable">
                    <thead id="tableHeader">
                        <!-- Se generar√° din√°micamente seg√∫n el local -->
                    </thead>
                    <tbody id="tableBody">
                        <!-- Se llenar√° din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // DATOS COMPLETOS - 193 productos MZ + 205 productos NU
        const productosMZ = [{"nombre":"Agua sin gas","categoria":"Bebidas s/a","unidades":4524,"venta":12365068.7},
            {nombre: "Agua con gas", categoria: "Bebidas s/a", unidades: 1254, venta: 3379097.11},
            {nombre: "Corona", categoria: "Bebidas s/a", unidades: 2152, venta: 11220430.4},
            {nombre: "Michelada", categoria: "Bebidas s/a", unidades: 481, venta: 2745368.93},
            {nombre: "Margarita FROZEN", categoria: "Bebidas s/a", unidades: 4816, venta: 23678808.1},
            {nombre: "Caipiroska", categoria: "Bebidas s/a", unidades: 299, venta: 2231786.76},
            {nombre: "Caipiroska maracuya", categoria: "Bebidas s/a", unidades: 511, venta: 4379611.45},
            {nombre: "Caipirinha", categoria: "Bebidas s/a", unidades: 303, venta: 2309837.27},
            {nombre: "Caipirinha maracuya", categoria: "Bebidas s/a", unidades: 146, venta: 1285783.68},
            {nombre: "Daiquiri", categoria: "Bebidas s/a", unidades: 461, venta: 3591063.67},
            {nombre: "Mojito", categoria: "Bebidas s/a", unidades: 381, venta: 2973735},
            {nombre: "Cuba libre", categoria: "Bebidas s/a", unidades: 67, venta: 367498.9},
            {nombre: "Fernet cola", categoria: "Bebidas s/a", unidades: 269, venta: 1451177.55},
            {nombre: "MEXICAN Bulldog", categoria: "Bebidas s/a", unidades: 889, venta: 15556818},
            {nombre: "Gin tonic", categoria: "Bebidas s/a", unidades: 532, venta: 3758173.88},
            {nombre: "Aperol Spritz", categoria: "Bebidas s/a", unidades: 430, venta: 3400000},
            {nombre: "Licuado", categoria: "Bebidas s/a", unidades: 511, venta: 2442848.34},
            {nombre: "Limonada", categoria: "Bebidas s/a", unidades: 4507, venta: 19188201.9},
            {nombre: "Coca", categoria: "Bebidas s/a", unidades: 2749, venta: 8798438.6},
            {nombre: "Coca Zero", categoria: "Bebidas s/a", unidades: 3058, venta: 9890859.03},
            {nombre: "Sprite", categoria: "Bebidas s/a", unidades: 631, venta: 2011707.88},
            {nombre: "Mini Burritos x3", categoria: "Comida", unidades: 2468, venta: 38797080},
            {nombre: "Quesadilla Pollo", categoria: "Comida", unidades: 1056, venta: 15571279.7},
            {nombre: "Nachos Tex Mex", categoria: "Comida", unidades: 1339, venta: 22026363},
            {nombre: "Mix Fajitas", categoria: "Comida", unidades: 1060, venta: 48793590},
            {nombre: "Fajitas Res", categoria: "Comida", unidades: 255.5, venta: 12348584.8},
            {nombre: "Botana", categoria: "Comida", unidades: 4501, venta: 179685160},
            {nombre: "Ensalada Caesar c pollo", categoria: "Comida", unidades: 169, venta: 1992990.03},
            {nombre: "Papas Fritas", categoria: "Comida", unidades: 812, venta: 6219680.76},
            {nombre: "Flautas", categoria: "Comida", unidades: 1580, venta: 12433004.1},
            {nombre: "Guacamole strips", categoria: "Comida", unidades: 1676, venta: 19782474.7},
            {nombre: "Botana G", categoria: "Comida", unidades: 427, venta: 19719825.9},
            {nombre: "Burro XL Carnitas", categoria: "Comida", unidades: 974, venta: 18550905.3},
            {nombre: "Volcan chocolate", categoria: "Postres", unidades: 1176, venta: 8858747.18},
            {nombre: "Volcan dulce de leche", categoria: "Postres", unidades: 364, venta: 2770485.47},
            {nombre: "Key lime pie", categoria: "Postres", unidades: 336, venta: 2511454.67},
            {nombre: "Cafe Lavazza", categoria: "Postres", unidades: 945, venta: 2977028.19},
            {nombre: "Taco Res", categoria: "Tacos", unidades: 5695, venta: 26882122.9},
            {nombre: "Taco Pollo", categoria: "Tacos", unidades: 3238, venta: 15446039.2},
            {nombre: "Taco Cerdo", categoria: "Tacos", unidades: 1599, venta: 9106222.44},
            {nombre: "Taco Pastor", categoria: "Tacos", unidades: 2628, venta: 14744235.1},
            {nombre: "Taco Gobernador", categoria: "Tacos", unidades: 2021, venta: 11362426.9},
            {nombre: "Tacos Clasicos", categoria: "Tacos", unidades: 2968, venta: 41936903.1},
            {nombre: "Tacos Agave", categoria: "Tacos", unidades: 3249, venta: 55566711.5}
        ])};

        const productosNU = ${JSON.stringify([
            {nombre: "Agua sin gas", categoria: "Bebidas s/a", unidades: 1619, venta: 4167152.22},
            {nombre: "Agua con gas", categoria: "Bebidas s/a", unidades: 514, venta: 1363450.32},
            {nombre: "Corona", categoria: "Bebidas s/a", unidades: 1070, venta: 4684432.83},
            {nombre: "Michelada", categoria: "Bebidas s/a", unidades: 303, venta: 1694508.44},
            {nombre: "Margarita FROZEN", categoria: "Bebidas s/a", unidades: 2545, venta: 11270220.7},
            {nombre: "Caipiroska", categoria: "Bebidas s/a", unidades: 181, venta: 1314942.08},
            {nombre: "Caipiroska maracuya", categoria: "Bebidas s/a", unidades: 272, venta: 2186303.72},
            {nombre: "Caipirinha", categoria: "Bebidas s/a", unidades: 156, venta: 1084610.03},
            {nombre: "Daiquiri", categoria: "Bebidas s/a", unidades: 236, venta: 1746139.66},
            {nombre: "Mojito", categoria: "Bebidas s/a", unidades: 187, venta: 1379354.25},
            {nombre: "Fernet cola", categoria: "Bebidas s/a", unidades: 275, venta: 727190.74},
            {nombre: "MEXICAN Bulldog", categoria: "Bebidas s/a", unidades: 410, venta: 6819284.41},
            {nombre: "Gin tonic", categoria: "Bebidas s/a", unidades: 306, venta: 1748518.88},
            {nombre: "Aperol Spritz", categoria: "Bebidas s/a", unidades: 252, venta: 1606379.9},
            {nombre: "Licuado", categoria: "Bebidas s/a", unidades: 225, venta: 1059790.72},
            {nombre: "Limonada", categoria: "Bebidas s/a", unidades: 1459, venta: 6065735.42},
            {nombre: "Coca", categoria: "Bebidas s/a", unidades: 1035, venta: 3138299.43},
            {nombre: "Coca Zero", categoria: "Bebidas s/a", unidades: 1076, venta: 3214171.97},
            {nombre: "Sprite", categoria: "Bebidas s/a", unidades: 260, venta: 805255.02},
            {nombre: "Mini Burritos x3", categoria: "Comida", unidades: 1123, venta: 17637068.4},
            {nombre: "Quesadilla Pollo", categoria: "Comida", unidades: 494, venta: 7233549.25},
            {nombre: "Nachos Tex Mex", categoria: "Comida", unidades: 678, venta: 10910339.6},
            {nombre: "Mix Fajitas", categoria: "Comida", unidades: 419, venta: 17937010.1},
            {nombre: "Fajitas Res", categoria: "Comida", unidades: 106, venta: 4315983.13},
            {nombre: "Botana", categoria: "Comida", unidades: 1948, venta: 74548603.1},
            {nombre: "Papas Fritas", categoria: "Comida", unidades: 418, venta: 2795374.85},
            {nombre: "Flautas", categoria: "Comida", unidades: 758, venta: 5561210.25},
            {nombre: "Guacamole strips", categoria: "Comida", unidades: 694, venta: 7969818.31},
            {nombre: "Botana G", categoria: "Comida", unidades: 296, venta: 13483648.2},
            {nombre: "Burro XL Carnitas", categoria: "Comida", unidades: 596, venta: 11429717.4},
            {nombre: "Men√∫ Tacos", categoria: "Comida", unidades: 872, venta: 14129216.3},
            {nombre: "Menu E1", categoria: "Comida", unidades: 651, venta: 10763904.8},
            {nombre: "Volcan chocolate", categoria: "Postres", unidades: 635, venta: 4487223.17},
            {nombre: "Volcan dulce de leche", categoria: "Postres", unidades: 195, venta: 1244172.48},
            {nombre: "Key lime pie", categoria: "Postres", unidades: 277, venta: 1735173.94},
            {nombre: "Cafe Lavazza", categoria: "Postres", unidades: 329, venta: 973981.33},
            {nombre: "Taco Res", categoria: "Tacos", unidades: 2308, venta: 10393542.5},
            {nombre: "Taco Pollo", categoria: "Tacos", unidades: 1267, venta: 5665572.31},
            {nombre: "Taco Cerdo", categoria: "Tacos", unidades: 607, venta: 3285079.63},
            {nombre: "Taco Pastor", categoria: "Tacos", unidades: 1298, venta: 6993932.04},
            {nombre: "Taco Gobernador", categoria: "Tacos", unidades: 931, venta: 4864411.87},
            {nombre: "Tacos Clasicos", categoria: "Tacos", unidades: 1090, venta: 15473797.4},
            {nombre: "Tacos Agave", categoria: "Tacos", unidades: 1382, venta: 22919436.4}
        ])};

        let currentFilter = 'todas';
        let currentLocal = 'comparativo';
        let allProducts = [];

        // Cambiar vista de local
        function changeLocal(local) {
            currentLocal = local;

            // Actualizar botones
            document.querySelectorAll('.local-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Actualizar t√≠tulo
            const titles = {
                'comparativo': 'üìä Ranking Completo de Productos - Comparativo',
                'martinez': 'üè¢ Ranking Completo de Productos - Mart√≠nez',
                'nunez': 'üè¢ Ranking Completo de Productos - N√∫√±ez'
            };
            document.getElementById('tableTitle').textContent = titles[local];

            // Actualizar encabezados y tabla
            updateTableHeaders();
            applyFilters();
        }

        // Actualizar encabezados seg√∫n local
        function updateTableHeaders() {
            const thead = document.getElementById('tableHeader');

            if (currentLocal === 'comparativo') {
                thead.innerHTML = `
                    <tr>
                        <th onclick="sortTable(0)">#</th>
                        <th onclick="sortTable(1)">Producto</th>
                        <th onclick="sortTable(2)">Categor√≠a</th>
                        <th onclick="sortTable(3)">MZ Facturaci√≥n</th>
                        <th onclick="sortTable(4)">MZ Unidades</th>
                        <th onclick="sortTable(5)">NU Facturaci√≥n</th>
                        <th onclick="sortTable(6)">NU Unidades</th>
                        <th onclick="sortTable(7)">Total ARS</th>
                    </tr>
                `;
            } else if (currentLocal === 'martinez') {
                thead.innerHTML = `
                    <tr>
                        <th onclick="sortTable(0)">#</th>
                        <th onclick="sortTable(1)">Producto</th>
                        <th onclick="sortTable(2)">Categor√≠a</th>
                        <th onclick="sortTable(3)">Facturaci√≥n ARS</th>
                        <th onclick="sortTable(4)">Unidades</th>
                        <th onclick="sortTable(5)">Precio Promedio</th>
                    </tr>
                `;
            } else { // nunez
                thead.innerHTML = `
                    <tr>
                        <th onclick="sortTable(0)">#</th>
                        <th onclick="sortTable(1)">Producto</th>
                        <th onclick="sortTable(2)">Categor√≠a</th>
                        <th onclick="sortTable(3)">Facturaci√≥n ARS</th>
                        <th onclick="sortTable(4)">Unidades</th>
                        <th onclick="sortTable(5)">Precio Promedio</th>
                    </tr>
                `;
            }
        }

        // Combinar productos de ambos locales
        function combineProducts() {
            const combined = {};

            productosMZ.forEach(p => {
                const key = p.nombre.toLowerCase();
                if (!combined[key]) {
                    combined[key] = {
                        nombre: p.nombre,
                        categoria: p.categoria,
                        mzVenta: 0,
                        mzUnidades: 0,
                        nuVenta: 0,
                        nuUnidades: 0
                    };
                }
                combined[key].mzVenta = p.venta;
                combined[key].mzUnidades = p.unidades;
            });

            productosNU.forEach(p => {
                const key = p.nombre.toLowerCase();
                if (!combined[key]) {
                    combined[key] = {
                        nombre: p.nombre,
                        categoria: p.categoria,
                        mzVenta: 0,
                        mzUnidades: 0,
                        nuVenta: 0,
                        nuUnidades: 0
                    };
                }
                combined[key].nuVenta = p.venta;
                combined[key].nuUnidades = p.unidades;
            });

            return Object.values(combined).map(p => ({
                ...p,
                totalVenta: p.mzVenta + p.nuVenta
            })).sort((a, b) => b.totalVenta - a.totalVenta);
        }

        allProducts = combineProducts();

        // Renderizar tabla seg√∫n local seleccionado
        function renderTable(products) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            products.forEach((p, index) => {
                const row = tbody.insertRow();

                if (currentLocal === 'comparativo') {
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${p.nombre}</strong></td>
                        <td>${p.categoria}</td>
                        <td>$${formatNumber(p.mzVenta)}</td>
                        <td>${formatNumber(p.mzUnidades)}</td>
                        <td>$${formatNumber(p.nuVenta)}</td>
                        <td>${formatNumber(p.nuUnidades)}</td>
                        <td><strong>$${formatNumber(p.totalVenta)}</strong></td>
                    `;
                } else if (currentLocal === 'martinez') {
                    const precioPromedio = p.mzUnidades > 0 ? p.mzVenta / p.mzUnidades : 0;
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${p.nombre}</strong></td>
                        <td>${p.categoria}</td>
                        <td><strong>$${formatNumber(p.mzVenta)}</strong></td>
                        <td>${formatNumber(p.mzUnidades)}</td>
                        <td>$${formatNumber(precioPromedio)}</td>
                    `;
                } else { // nunez
                    const precioPromedio = p.nuUnidades > 0 ? p.nuVenta / p.nuUnidades : 0;
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${p.nombre}</strong></td>
                        <td>${p.categoria}</td>
                        <td><strong>$${formatNumber(p.nuVenta)}</strong></td>
                        <td>${formatNumber(p.nuUnidades)}</td>
                        <td>$${formatNumber(precioPromedio)}</td>
                    `;
                }
            });
        }

        // Formatear n√∫meros
        function formatNumber(num) {
            return Math.round(num).toLocaleString('es-AR');
        }

        // Aplicar filtros (categor√≠a + local)
        function applyFilters() {
            let filtered = allProducts;

            // Filtrar por categor√≠a
            if (currentFilter !== 'todas') {
                filtered = allProducts.filter(p => p.categoria === currentFilter);
            }

            // Ordenar seg√∫n local
            if (currentLocal === 'martinez') {
                filtered = filtered.sort((a, b) => b.mzVenta - a.mzVenta);
            } else if (currentLocal === 'nunez') {
                filtered = filtered.sort((a, b) => b.nuVenta - a.nuVenta);
            } else {
                filtered = filtered.sort((a, b) => b.totalVenta - a.totalVenta);
            }

            renderTable(filtered);
            updateFilterStatus();
            document.getElementById('searchResults').style.display = 'none';
        }

        // Actualizar texto de estado
        function updateFilterStatus() {
            const localNames = {
                'comparativo': 'Comparativo',
                'martinez': 'Mart√≠nez',
                'nunez': 'N√∫√±ez'
            };
            const catName = currentFilter === 'todas' ? 'Todas las categor√≠as' : currentFilter;
            document.getElementById('filterStatus').textContent =
                `Mostrando: ${catName} | Local: ${localNames[currentLocal]}`;
        }

        // Filtrar por categor√≠a
        function filterCategory(cat) {
            currentFilter = cat;

            // Actualizar botones
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            applyFilters();
        }

        // Buscar producto
        function searchProduct() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!query) {
                alert('Por favor ingresa un t√©rmino de b√∫squeda');
                return;
            }

            const results = allProducts.filter(p =>
                p.nombre.toLowerCase().includes(query)
            );

            const resultsDiv = document.getElementById('searchResults');

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">‚ùå No se encontraron productos con ese t√©rmino</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            let html = `
                <div class="section">
                    <h2>üîç Resultados de b√∫squeda: "${query}" (${results.length} productos)</h2>
            `;

            results.forEach(p => {
                html += `
                    <div class="comparison-card">
                        <h3>${p.nombre}</h3>
                        <p style="color: #666; margin-bottom: 15px;">Categor√≠a: ${p.categoria}</p>
                        <div class="comparison-grid">
                            <div class="comparison-item martinez">
                                <div class="label">Mart√≠nez - Facturaci√≥n</div>
                                <div class="value">$${formatNumber(p.mzVenta)}</div>
                                <div class="label" style="margin-top: 10px;">Unidades: ${formatNumber(p.mzUnidades)}</div>
                            </div>
                            <div class="comparison-item nunez">
                                <div class="label">N√∫√±ez - Facturaci√≥n</div>
                                <div class="value">$${formatNumber(p.nuVenta)}</div>
                                <div class="label" style="margin-top: 10px;">Unidades: ${formatNumber(p.nuUnidades)}</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; text-align: center; font-size: 1.2em;">
                            <strong>Total: $${formatNumber(p.totalVenta)} ARS</strong>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }

        // Limpiar b√∫squeda
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').style.display = 'none';
        }

        // Ordenar tabla
        let sortDirection = {};
        function sortTable(columnIndex) {
            const table = document.getElementById('productsTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            if (!sortDirection[columnIndex]) sortDirection[columnIndex] = 1;
            sortDirection[columnIndex] *= -1;

            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent;
                let bVal = b.cells[columnIndex].textContent;

                // Si es n√∫mero, comparar como n√∫mero
                aVal = aVal.replace(/[$,]/g, '');
                bVal = bVal.replace(/[$,]/g, '');

                if (!isNaN(aVal) && !isNaN(bVal)) {
                    return sortDirection[columnIndex] * (parseFloat(aVal) - parseFloat(bVal));
                }

                return sortDirection[columnIndex] * aVal.localeCompare(bVal);
            });

            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        // Inicializar
        updateTableHeaders();
        applyFilters();

        // Enter en b√∫squeda
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProduct();
            }
        });
    </script>
</body>
</html>